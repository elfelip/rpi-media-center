- hosts:
    all
  vars:
    kodi_addons_directory: "/usr/share/kodi/addons/"
    rpi_media_center_prereq_packages:
      - apt-transport-https
      - kodi-inputstream-adaptive
#      - libwidevine
    raspotify_repo: "deb https://dtcooper.github.io/raspotify raspotify main"
    raspotify_key: "https://dtcooper.github.io/raspotify/key.asc" 
    raspotify_packages:
      - raspotify
    netflix_repository_url: https://github.com/castagnait/repository.castagnait/raw/master/repository.castagnait-1.0.0.zip
  roles:
    - name: ansible-kodi-raspbian
      memory_split: 256
  tasks:
    - name: Installer les prerequis
      apt: 
        pkg: "{{ rpi_media_center_prereq_packages }}"
        state: present

    - name: Installer le repo de raspotify
      apt_repository:
        repo: "{{ raspotify_repo }}"
        state: present

    - name: Installer la clé du repo raspotify
      apt_key:
        url: "{{ raspotify_key }}"
        state: present

    - name: Installer raspotify
      apt:
        pkg: "{{ raspotify_packages }}"

    - name: Installer pycryptodomex pour le user pi pour Netflix.
      pip:
        name: pycryptodomex
        extra_args: --user
      become: False

    - name: Télécharger le repository pour le add-on Netflix
      unarchive:
        src: "{{ netflix_repository_url }}"
        dest: "{{ kodi_addons_directory }}"
        remote_src: yes

      
